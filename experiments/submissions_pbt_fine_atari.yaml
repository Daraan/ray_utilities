global_pattern_1: >
  python experiments/tune_with_scheduler.py
  --env_type <ENV_TYPE>
  --tune <TUNE_PARAM> --num_samples 1
  --vf_share_layers
  --gpu 0.5
  <OTHER_FLAGS:>
  --tag:core --tag:pbt  --tag:pbt-grouped --tag:pbt-fine --tag:shared-encoder  -tag:atari
  --comet offline --wandb offline+upload@end --log_stats learners
  --hostname_selector '!in(dws-login-01,dws-login-02)'
  --total_steps 262144 --use_exact_total_steps
  pbt --grouped --group_size 3 --perturbation_interval 32768 --quantile_fraction 0.01
# NOTE: Use set +H when using hostname selector
# --- Envs --- #
<mujoco_envs>:
- use another key
<mujoco_envs_ext>:
- use another key
<basic_envs>:
- "ALE-Pong-v5"
- "ALE-Breakout-v5"
- "ALE-SpaceInvaders-v5"
# ---
test_command:
  test:id:
    entrypoint: >
      python
      -c "print('Hello, World!')"
# ---
pbt_fine_batch_size_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: batch_size
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    # custom resource to not schedule on SLURM nodes that time out too early
    persistent_node: 1
  run_ids:
    (Pong-v5):
      tws47f2512220008700a4:
        status: STOPPED
        submission_id: pbt_fine_batch_size_base_ALE-Pong-v5_2025-12-22_00:07:54
pbt_fine_batch_size_base_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: batch_size
      # Test first
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
  entrypoint_resources:
    # custom resource to not schedule on SLURM nodes that time out too early
    persistent_node: 1
pbt_fine_minibatch_size_base:
  comment: tune minibatch_size with fixed train_batch_size_per_learner=2048
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: minibatch_size
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |-
        --train_batch_size_per_learner 2048
pbt_fine_minibatch_size_large_base:
  comment: tune minibatch_size with fixed train_batch_size_per_learner=8192
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: minibatch_size
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |-
        --train_batch_size_per_learner 8192
pbt_fine_accumulate:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: accumulate_gradients_every
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1
  run_ids:
    (Pong-v5):
      tws47f25122200196b904:
        status: STOPPED
        submission_id: pbt_fine_accumulate_ALE-Pong-v5_2025-12-22_00:18:30
      tws47f25122200424ba34:
        status: FAILED
        submission_id: pbt_fine_accumulate_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_num_envs:
  # This is a comment
  comment: small minibatch_size=256 and train_batch_size=2048
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1
  run_ids:
    (Pong-v5):
      tws47f2512220056185b4:
        status: FAILED
        submission_id: pbt_fine_num_envs_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_num_envs_large:
  comment: minibatch_size=516 and train_batch_size_per_learner=8192 (same 1/16)
    scale
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192

pbt_fine_clip_param:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: clip_param
      <ENV_TYPE>: <basic_envs>
pbt_fine_clip_param_base_large:
  # Change to non-base
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: clip_param
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
pbt_fine_entropy_coeff_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: entropy_coeff
      <ENV_TYPE>: <basic_envs>
pbt_fine_vf_loss_coeff_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: vf_loss_coeff
      <ENV_TYPE>: <basic_envs>
pbt_fine_gamma_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1

  run_ids:
    (Pong-v5):
      tws47f25122204121dc64:
        status: RUNNING
        submission_id: pbt_fine_gamma_base_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_gamma_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1
pbt_fine_lr_base:
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <basic_envs>
  run_ids:
    (Pong-v5):
      tws47f2512220414f8704:
        status: STOPPED
        submission_id: pbt_fine_lr_base_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_lr_large:
  comment: minibatch_size=516 and train_batch_size_per_learner=8192 (same 1/16)
    scale  - need to repeat because of 2 top groups
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
pbt_fine_vf_clip_param_base:
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: vf_clip_param
      <ENV_TYPE>: <basic_envs>

# --- Added gamma and grad_clip groups ---

# region grad clip
  run_ids:
    (Pong-v5):
      tws47f25122204214b754:
        status: RUNNING
        submission_id:
          pbt_fine_vf_clip_param_base_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_grad_clip_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1

  run_ids:
    (Pong-v5):
      tws47f2512220423f76d4:
        status: RUNNING
        submission_id: pbt_fine_grad_clip_base_ALE-Pong-v5_2025-12-22_00:40:31
pbt_fine_grad_clip_base_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1
