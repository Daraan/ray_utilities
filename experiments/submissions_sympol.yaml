global_pattern_1: >
  python experiments/sympol_pbt.py
  -a sympol
  --env_type <ENV_TYPE>
  --tune <TUNE_PARAM> --num_samples 1
  <OTHER_FLAGS:>
  --tag:core --tag:pbt  --tag:pbt-grouped
  --buffer_length auto
  --comet offline --wandb offline+upload@end --log_stats learners
  --hostname_selector '!in(dws-login-01,dws-login-02)'
  pbt --grouped --group_size 3 --perturbation_interval 0.125 --quantile_fraction 0.05
# NOTE: Use set +H when using hostname selector, use a small quantile_fraction to have only 1 top group
# Do I need other sympol arguments?
submit_pattern: >
  # Example for direct CLI
  ray job submit --working-dir "." --entrypoint-memory 3000000000  --entrypoint-num-cpus
  0.66 --entrypoint-resources '{"persistent_node":1}'
  --submission-id pbt_batch_size_mlp-xxxxxxxxx_restore -- \  python  experiments/tune_with_scheduler.py
  --restore_path yyyyy  --hostname_selector '!in(dws-login-01,dws-login-02)'

  --submission-id pbt_batch_size_InvertedDoublePendulum-v5_7435_restore -- python  experiments/tune_with_scheduler.py
  --restore_path /home/dsperber/master/repos/ray_utilities/outputs/shared/experiments/Default-mlp-InvertedPendulum-v5/pbt-tune_tune:batch_size/Default-mlp-InvertedPendulum-v5-tws47f25112200240e674
  --hostname_selector '!in(dws-login-01,dws-login-02)'
notes: |
  - All here do:
    - NOT use KL loss
    - use entropy_coeff=0.01 (default 0.0)
    - Use GAE and critic
# --- Envs --- #
<mujoco_envs>:
  # ONLY discrete action spaces for SYMPOL?
- HumanoidStandup-v5
- Humanoid-v5
- Ant-v5
- Hopper-v5
- Walker2d-v5
- HalfCheetah-v5
- Reacher-v5
- Swimmer-v5
- Pusher-v5
- InvertedDoublePendulum-v5
- InvertedPendulum-v5
<basic_envs>:
- CartPole-v1
- Acrobot-v1
- LunarLander-v3
# ---
test_command:
  test:id:
    entrypoint: >
      python
      -c "print('Hello, World!')"
# ---
sympol_pbt_batch_size_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: batch_size
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1
  run_ids:
    (Acrobot-v1):
      sp87c6251205162313004:
        status: SUCCEEDED
        submission_id: sympol_pbt_batch_size_base_Acrobot-v1_2025-12-05_15:52:30
    (LunarLander-v3):
      sp87c6251205071523e54:
        status: FAILED
        submission_id:
          sympol_pbt_batch_size_base_LunarLander-v3_2025-12-05_07:15:09
      sp87c6251205165341fd4:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_batch_size_base_LunarLander-v3_2025-12-05_15:52:30
    (CartPole-v1):
      sp87c62512051553e9c84:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_batch_size_base_CartPole-v1_2025-12-05_15:52:30
sympol_pbt_batch_size:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: batch_size
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    persistent_node: 1
  run_ids:
    (Humanoid-v5):
      sp87c625120521264ffa4:
        status: SUCCEEDED
        submission_id: sympol_pbt_batch_size_Humanoid-v5_2025-12-05_21:26:08
    (Ant-v5):
      sp87c62512052238cff44:
        status: RUNNING
        submission_id: sympol_pbt_batch_size_Ant-v5_2025-12-05_22:37:50
    (Walker2d-v5):
      sp87c62512052243dbd74:
        status: RUNNING
        submission_id: sympol_pbt_batch_size_Walker2d-v5_2025-12-05_22:37:50
    (InvertedPendulum-v5):
      sp87c625120606117c794:
        status: RUNNING
        submission_id:
          sympol_pbt_batch_size_InvertedPendulum-v5_2025-12-05_22:37:50
    (Swimmer-v5):
      sp87c62512052254c1d94:
        status: RUNNING
        submission_id: sympol_pbt_batch_size_Swimmer-v5_2025-12-05_22:37:50
    (HalfCheetah-v5):
      sp87c62512052245ff3e4:
        status: RUNNING
        submission_id: sympol_pbt_batch_size_HalfCheetah-v5_2025-12-05_22:37:50
    (Reacher-v5):
      sp87c6251205224924524:
        status: SUCCEEDED
        submission_id: sympol_pbt_batch_size_Reacher-v5_2025-12-05_22:37:50
    (InvertedDoublePendulum-v5):
      sp87c6251206030573604:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_batch_size_InvertedDoublePendulum-v5_2025-12-05_22:37:50
    (Hopper-v5):
      sp87c62512061459508d4:
        status: RUNNING
        submission_id: sympol_pbt_batch_size_Hopper-v5_2025-12-06_14:59:30
sympol_pbt_minibatch_size_2048:
  comment: tune minibatch_size with fixed train_batch_size_per_learner=2048
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: minibatch_size
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |-
        --train_batch_size_per_learner 2048
  run_ids:
    (Ant-v5):
      sp87c625120606268afb4:
        status: RUNNING
        submission_id: sympol_pbt_minibatch_size_2048_Ant-v5_2025-12-05_22:37:50
    (Humanoid-v5):
      sp87c62512060625819b4:
        status: RUNNING
        submission_id:
          sympol_pbt_minibatch_size_2048_Humanoid-v5_2025-12-05_22:37:50
      Humanoid-v5:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_2048_Humanoid-v5_2025-12-05_22:37:50
    (Walker2d-v5):
      sp87c62512060627048c4:
        status: RUNNING
        submission_id:
          sympol_pbt_minibatch_size_2048_Walker2d-v5_2025-12-05_22:37:50
    (HalfCheetah-v5):
      sp87c6251206062735474:
        status: RUNNING
        submission_id:
          sympol_pbt_minibatch_size_2048_HalfCheetah-v5_2025-12-05_22:37:50
    (Reacher-v5):
      sp87c6251206063037a94:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_2048_Reacher-v5_2025-12-05_22:37:50
    (Hopper-v5):
      sp87c62512061501629b4:
        status: RUNNING
        submission_id:
          sympol_pbt_minibatch_size_2048_Hopper-v5_2025-12-06_14:59:30
    (Swimmer-v5):
      sp87c625120615355b224:
        status: RUNNING
        submission_id:
          sympol_pbt_minibatch_size_2048_Swimmer-v5_2025-12-06_14:59:30
sympol_pbt_minibatch_size_8192_base:
  comment: tune minibatch_size with fixed train_batch_size_per_learner=8192
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: minibatch_size
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |-
        --train_batch_size_per_learner 8192
  run_ids:
    (CartPole-v1):
      sp87c62512050850ef6d4:
        status: FAILED
        submission_id:
          sympol_pbt_minibatch_size_8192_base_CartPole-v1_2025-12-05_07:15:09
      sp87c62512051707398a4:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_base_CartPole-v1_2025-12-05_15:52:30
    (Acrobot-v1):
      sp87c62512051923c0d34:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_base_Acrobot-v1_2025-12-05_15:52:30
    (LunarLander-v3):
      sp87c625120509170c064:
        status: FAILED
        submission_id:
          sympol_pbt_minibatch_size_8192_base_LunarLander-v3_2025-12-05_07:15:09
      sp87c62512052210ce424:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_base_LunarLander-v3_2025-12-05_15:52:30
sympol_pbt_minibatch_size_8192:
  comment: tune minibatch_size with fixed train_batch_size_per_learner=8192
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: minibatch_size
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |-
        --train_batch_size_per_learner 8192
  run_ids:
    (HumanoidStandup-v5):
      sp87c625120516277e514:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_HumanoidStandup-v5_2025-12-05_16:26:36
    (Humanoid-v5):
      sp87c62512051646921f4:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_Humanoid-v5_2025-12-05_16:26:36
    (Ant-v5):
      sp87c62512051708b0414:
        status: SUCCEEDED
        submission_id: sympol_pbt_minibatch_size_8192_Ant-v5_2025-12-05_16:26:36
    (Hopper-v5):
      sp87c6251205171741b04:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_Hopper-v5_2025-12-05_16:26:36
    (Walker2d-v5):
      sp87c62512052010fcae4:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_Walker2d-v5_2025-12-05_16:26:36
    (HalfCheetah-v5):
      sp87c6251205204742d74:
        status: SUCCEEDED
        submission_id:
          sympol_pbt_minibatch_size_8192_HalfCheetah-v5_2025-12-05_16:26:36
sympol_pbt_num_envs:
  # This is a comment
  comment: small minibatch_size=256 and train_batch_size=2048
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    persistent_node: 1
sympol_pbt_num_envs_large:
  comment: minibatch_size=516 and train_batch_size_per_learner=8192 (same 1/16)
    scale
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
sympol_pbt_lr_base:
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <basic_envs>
sympol_pbt_lr:
  comment: spread lr - need to repeat because of 2 top groups
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <mujoco_envs>
sympol_pbt_lr_large:
  comment: minibatch_size=516 and train_batch_size_per_learner=8192 (same 1/16)
    scale  - need to repeat because of 2 top groups
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
sympol_pbt_lr_base_large:
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  run_ids:
    (LunarLander-v3):
      sp87c6251205151495d34:
        status: STOPPED
        submission_id:
          sympol_pbt_lr_base_large_LunarLander-v3_2025-12-05_07:15:09
sympol_pbt_clip_param_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: clip_param
      <ENV_TYPE>: <basic_envs>
  run_ids:
    (CartPole-v1):
      sp87c62512041943778c4:
        status: FAILED
        note: until 400k
sympol_pbt_clip_param:
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: clip_param
      <ENV_TYPE>: <mujoco_envs>
sympol_pbt_entropy_coeff_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: entropy_coeff
      <ENV_TYPE>: <basic_envs>
sympol_pbt_vf_loss_coeff_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: vf_loss_coeff
      <ENV_TYPE>: <basic_envs>
sympol_pbt_vf_clip_param_base:
  # TODO: Change to base
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: vf_clip_param
      <ENV_TYPE>: <basic_envs>
# region gamma
sympol_pbt_gamma_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1

sympol_pbt_gamma:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    persistent_node: 1

# region gamma
sympol_pbt_gamma_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1

sympol_pbt_gamma_base_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: gamma
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1
# endregion
# region grad_clip
sympol_pbt_grad_clip_base:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <basic_envs>
  entrypoint_resources:
    persistent_node: 1

sympol_pbt_grad_clip:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    persistent_node: 1

sympol_pbt_grad_clip_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1

sympol_pbt_grad_clip_base_large:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: grad_clip
      <ENV_TYPE>: <basic_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  entrypoint_resources:
    persistent_node: 1
#endregion
