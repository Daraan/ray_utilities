global_pattern_1: >
  python experiments/tune_with_scheduler.py
  --env_type <ENV_TYPE>
  --tune <TUNE_PARAM> --num_samples 1
  <OTHER_FLAGS:>
  --tag:core --tag:pbt
  --buffer_length auto
  --comet offline+upload@end --wandb offline+upload@end --log_stats learners
  --hostname_selector '!in(dws-login-01,dws-login-02)'
  pbt --perturbation_interval 0.125 --quantile_fraction 0.1
# --- Envs --- #
<mujoco_envs>:
  - Ant-v5
  - Hopper-v5
  - Walker2d-v5
  - HalfCheetah-v5
  - Reacher-v5
  - Swimmer-v5
  - Pusher-v5
  - InvertedPendulum-v5
  - InvertedDoublePendulum-v5
  - Humanoid-v5
  - HumanoidStandup-v5
<basic_envs>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
# ---
test_command:
  test:id:
    entrypoint: >
      python
      -c "print('Hello, World!')"
# ---
pbt_batch_size:
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: batch_size
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    # custom resource to not schedule on SLURM nodes that time out too early
    persistent_node: 1
  run_ids:
    (Ant-v5):
      tws47f251117033903704:
        status: RUNNING
        submission_id: pbt_batch_size_Ant-v5_7132
      tws47f2511171634c38a4:
        status: STOPPED
        submission_id: pbt_batch_size_Ant-v5_3674
      tws47f2511171708de6a4:
        status: RUNNING
        submission_id: pbt_batch_size_Ant-v5_5708
    (Hopper-v5):
      tws47f2511170339db774:
        status: RUNNING
        submission_id: pbt_batch_size_Hopper-v5_7132
      tws47f2511171708558e4:
        status: RUNNING
        submission_id: pbt_batch_size_Hopper-v5_5708
    (Walker2d-v5):
      tws47f251117033976924:
        status: RUNNING
        submission_id: pbt_batch_size_Walker2d-v5_7132
      tws47f251117170873d54:
        status: RUNNING
        submission_id: pbt_batch_size_Walker2d-v5_5708
    (HalfCheetah-v5):
      tws47f2511170339a2834:
        status: RUNNING
        submission_id: pbt_batch_size_HalfCheetah-v5_7132
      tws47f25111717085a004:
        status: RUNNING
        submission_id: pbt_batch_size_HalfCheetah-v5_5708
    (Reacher-v5):
      tws47f25111703397c174:
        status: RUNNING
        submission_id: pbt_batch_size_Reacher-v5_7132
      tws47f251117171689e64:
        status: RUNNING
        submission_id: pbt_batch_size_Reacher-v5_5708
    (Swimmer-v5):
      tws47f2511170339c7be4:
        status: RUNNING
        submission_id: pbt_batch_size_Swimmer-v5_7132
      tws47f251117171618cf4:
        status: RUNNING
        submission_id: pbt_batch_size_Swimmer-v5_5708
    (Pusher-v5):
      tws47f25111703471fd54:
        status: RUNNING
        submission_id: pbt_batch_size_Pusher-v5_7132
      tws47f2511171716f61b4:
        status: RUNNING
        submission_id: pbt_batch_size_Pusher-v5_5708
    (InvertedPendulum-v5):
      tws47f2511170347b25a4:
        status: RUNNING
        submission_id: pbt_batch_size_InvertedPendulum-v5_7132
      tws47f2511171716c6d84:
        status: RUNNING
        submission_id: pbt_batch_size_InvertedPendulum-v5_5708
    (InvertedDoublePendulum-v5):
      tws47f251117034770ac4:
        status: RUNNING
        submission_id: pbt_batch_size_InvertedDoublePendulum-v5_7132
      tws47f251117171816d94:
        status: RUNNING
        submission_id: pbt_batch_size_InvertedDoublePendulum-v5_5708
    (Humanoid-v5):
      tws47f25111703470cfd4:
        status: RUNNING
        submission_id: pbt_batch_size_Humanoid-v5_7132
      tws47f251117171725b64:
        status: RUNNING
        submission_id: pbt_batch_size_Humanoid-v5_5708
    (HumanoidStandup-v5):
      tws47f25111703473f5d4:
        status: RUNNING
        submission_id: pbt_batch_size_HumanoidStandup-v5_7132
      tws47f2511171718c69c4:
        status: RUNNING
        submission_id: pbt_batch_size_HumanoidStandup-v5_5708
# ---
pbt_num_envs:
  # This is a comment
  comment: small minibatch_size=256 and train_batch_size=2048
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <mujoco_envs>
  entrypoint_resources:
    persistent_node: 1
  run_ids:
    (Ant-v5):
      tws47f25111613162c0c4: RESTORING
    (HalfCheetah-v5):
      tws47f251116131644cd4: RUNNING
    (Hopper-v5):
      tws47f251116131696844: RUNNING
    (Humanoid-v5):
      tws47f251116132047a84: SUCCEEDED - upload complete
    (HumanoidStandup-v5):
      tws47f251116132077264:
        status: SUCCEEDED - NEEDS REPLAY
      tws47f251117013189d94:
        status: RUNNING
    (InvertedDoublePendulum-v5):
      tws47f251116155671db4: RUNNING
    (InvertedPendulum-v5):
      tws47f2511161320022c4:
        status: SUCCEEDED
        submission_id: pbt_num_envs_InvertedPendulum-v5_5343
    (Pusher-v5):
      tws47f251116132006fa4:
        status: SUCCEEDED
        submission_id: pbt_num_envs_Pusher-v5_5343
    (Reacher-v5):
      tws47f25111613166c304:
        status: SUCCEEDED
        comment: single env worked best, most envs worst. 2 envs at the start
          superior to all others. reducing to single env after first
          perturbation big boost. 2 & 4 envs were good as well. Strange drop at
          3rd perturbation, recovered at 4th
        submission_id: pbt_num_envs_Reacher-v5_5343
    (Swimmer-v5):
      tws47f2511161320d60e4: RUNNING
    (Walker2d-v5):
      tws47f251116131630b04: RUNNING
pbt_num_envs_large:
  comment: minibatch_size=516 and train_batch_size_per_learner=8192 (same 1/16)
    scale
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: num_envs_per_env_runner
      <ENV_TYPE>: <mujoco_envs>
      <OTHER_FLAGS>: |
        --minibatch_size 1024
        --train_batch_size_per_learner 8192
  # TODO all states are GONE
  run_ids:
    (HumanoidStandup-v5):
      tws47f2511161809011b4:
        status: RESTORING - possible early perturbation of last trial
    (Humanoid-v5):
      tws47f251116132047a84: DONE?
    (Ant-v5):
      tws47f2511161804f37c4:
        status: RESTORING - possibly messed up perturbation ray job submit
          --working-dir "." --entrypoint-memory 1250000000
          --entrypoint-resources '{"persistent_node":1}' --entrypoint-num-cpus 1
          --submission-id pbt_num_envs_large_Ant-v5_restore -- python
          experiments/tune_with_scheduler.py --restore_path
    (InvertedDoublePendulum-v5):
      tws47f25111618057db34:
        status: SUCCEEDED - needs wandb upload
    (Swimmer-v5):
      tws47f2511161805fe2c4:
        status: RESTORING  - some wrong perturbations at the end. Needs Uupload
    (Hopper-v5):
      tws47f25111618041c084:
        status: SUCCEEDED
    (InvertedPendulum-v5):
      tws47f25111618050c314:
        status: SUCCEEDED
    (HalfCheetah-v5):
      tws47f251116180419184:
        status: SUCCEEDED
    (Pusher-v5):
      tws47f25111618054c884:
        status: SUCCEEDED
    (Reacher-v5):
      tws47f25111618056b3b4:
        status: SUCCEEDED
    (Walker2d-v5):
      tws47f2511161804f11044:
        status: SUCCEEDED
pbt_lr_base:
  <ENV_TYPE>:
  - CartPole-v1
  - Acrobot-v1
  - LunarLander-v3
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <basic_envs>
  run_ids:
    (CartPole-v1):
      tws47f25111703370cb24:
        status: RUNNING
        submission_id: pbt_lr_base_CartPole-v1_7014
    (Acrobot-v1):
      tws47f251117033729d54:
        status: RUNNING
        submission_id: pbt_lr_base_Acrobot-v1_7014
    (LunarLander-v3):
      tws47f2511170337ff2f4:
        status: RUNNING
        submission_id: pbt_lr_base_LunarLander-v3_7014
pbt_lr:
  comment: random lr between 5e-5 and 5e-1
  entrypoint_resources:
    persistent_node: 1
  entrypoint_pattern:
    pattern: global_pattern_1
    substitutions:
      <TUNE_PARAM>: lr
      <ENV_TYPE>: <mujoco_envs>
